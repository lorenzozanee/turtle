#include <Arduino.h>
#include <ESP32Servo.h>
  HardwareSerial MySerial(0);
bool first=1;
Servo servo;
int servoPin=17;

void standing_up(){
  MySerial.println("{#001P1500T2000!#002P1930T2000!#003P2050T2000!#004P1500T2000!#005P0880T2000!#006P1020T2000!#007P1500T2000!#008P1040T2000!#009P1060T2000!#010P1500T2000!#011P1050T2000!#012P1130T2000!}");
  delay(2010);
  MySerial.println("{#001P1500T2000!#002P2460T2000!#003P2460T2000!#004P1500T2000!#005P0500T2000!#006P0660T2000!#007P1500T2000!#008P0540T2000!#009P0580T2000!#010P1500T2000!#011P0540T2000!#012P0680T2000!}");
  delay(2010);
  MySerial.println("{#001P1500T2000!#002P1930T2000!#003P2050T2000!#004P1500T2000!#005P0880T2000!#006P1020T2000!#007P1500T2000!#008P1040T2000!#009P1060T2000!#010P1500T2000!#011P1050T2000!#012P1130T2000!}");
  delay(2010);
  MySerial.println("{#001P1500T2000!#002P1500T2000!#003P1500T2000!#004P1500T2000!#005P1500T2000!#006P1500T2000!#007P1500T2000!#008P1500T2000!#009P1500T2000!#010P1500T2000!#011P1500T2000!#012P1500T2000!}");
  delay(2010);
}
void open_servo(){
  servo.write(100);
  delay(200);
  servo.write(80);
  delay(400);
  servo.write(100);
  delay(100);
  servo.write(90);
//   for(int angle = 90; angle < 130; angle++) {
//         servo.write(angle);
//         MySerial.println(angle);
//         delay(15);
//         }// put your main code here, to run repeatedly:
//   for(int angle = 130; angle > 70; angle--) {
//         servo.write(angle);
//         MySerial.println(angle);
//         delay(15);
//         }// put your main code here, to run repeatedly:
//   for(int angle = 70; angle <= 90; angle++) {
//         servo.write(angle);
//         MySerial.println(angle);
//         delay(15);// put your main code here, to run repeatedly:
// }
}

void music(){
  // 第一部分指令组
MySerial.println("{#001P1500T0500!#002P1500T0500!#003P1500T0500!#004P1100T0500!#005P1400T0500!#006P1000T0500!#007P1500T0500!#008P1500T0500!#009P1500T0500!#010P1800T0500!#011P1700T0500!#012P1700T0500!#015P1805T1000!#016P1754T1000!}");
delay(1300);
MySerial.println("{#001P1500T0500!#002P1500T0500!#003P1500T0500!#004P1400T0500!#005P1400T0500!#006P1000T0500!#007P1500T0500!#008P1500T0500!#009P1500T0500!#010P1800T0500!#011P1700T0500!#012P1700T0500!#015P1801T600!}");
delay(1300);
// MySerial.println("{#015P1900T1000!}");  // 注释掉的指令
// delay(1300);
MySerial.println("{#001P1500T0500!#002P1500T0500!#003P1500T0500!#004P1100T0500!#005P1600T0500!#006P0910T0500!#007P1500T0500!#008P1500T0500!#009P1500T0500!#010P1800T0500!#011P1700T0500!#012P1700T0500!#015P0620T1000!}");
delay(1300);
MySerial.println("{#001P1500T0500!#002P1500T0500!#003P1500T0500!#004P0950T0500!#005P1400T0500!#006P1000T0500!#007P1500T0500!#008P1500T0500!#009P1500T0500!#010P1800T0500!#011P1700T0500!#012P1700T0500!#015P1510T1000!}");
delay(1300);
MySerial.println("{#001P1500T0500!#002P1500T0500!#003P1500T0500!#004P1100T0500!#005P1200T0500!#006P1010T0500!#007P1500T0500!#008P1500T0500!#009P1500T0500!#010P1800T0500!#011P1700T0500!#012P1700T0500!#015P1000T1000!}");
delay(1300);
MySerial.println("{#001P1500T0500!#002P1500T0500!#003P1500T0500!#004P1100T0500!#005P1400T0500!#006P1000T0500!#007P1500T0500!#008P1500T0500!#009P1500T0500!#010P1800T0500!#011P1700T0500!#012P1700T0500!#015P1010T1000!}");
delay(1300);
MySerial.println("{#001P1700T0500!#002P1500T0500!#003P2000T0500!#004P1200T0500!#005P1100T0500!#006P1300T0500!#007P1400T0500!#008P1750T0500!#009P1600T0500!#010P1700T0500!#011P1500T0500!#012P1700T0500!#015P1510T1000!}");
delay(1300);
MySerial.println("{#001P1500T0500!#002P1500T0500!#003P1500T0500!#004P1100T0500!#005P1400T0500!#006P1000T0500!#007P1500T0500!#008P1500T0500!#009P1500T0500!#010P1800T0500!#011P1700T0500!#012P1700T0500!#015P0620T1000!}");
delay(1300);
MySerial.println("{#001P1700T0500!#002P1500T0500!#003P2000T0500!#004P1200T0500!#005P1100T0500!#006P1300T0500!#007P1400T0500!#008P1750T0500!#009P1600T0500!#010P1700T0500!#011P1500T0500!#012P1700T0500!#015P0620T1000!}");
delay(1300);
MySerial.println("{#001P1500T0500!#002P1500T0500!#003P1500T0500!#004P1100T0500!#005P1400T0500!#006P1000T0500!#007P1500T0500!#008P1500T0500!#009P1500T0500!#010P1800T0500!#011P1700T0500!#012P1700T0500!#015P1500T1000!}");
delay(1300);
MySerial.println("{#001P1700T0500!#002P1500T0500!#003P2000T0500!#004P1200T0500!#005P1100T0500!#006P1300T0500!#007P1400T0500!#008P1750T0500!#009P1600T0500!#010P1700T0500!#011P1500T0500!#012P1700T0500!#015P0620T1000!}");
delay(1300);
MySerial.println("{#001P1500T0500!#002P1500T0500!#003P1500T0500!#004P1100T0500!#005P1400T0500!#006P1000T0500!#007P1500T0500!#008P1500T0500!#009P1500T0500!#010P1800T0500!#011P1700T0500!#012P1700T0500!#016P1500T1000!}");  // ################
delay(1300);

// 第二部分指令组
MySerial.println("{#001P1700T0500!#002P1500T0500!#003P2000T0500!#004P1200T0500!#005P1100T0500!#006P1300T0500!#007P1400T0500!#008P1750T0500!#009P1600T0500!#010P1700T0500!#011P1500T0500!#012P1700T0500!#015P1800T1000!#016P1754T1000!}");
delay(1300);
MySerial.println("{#015P1800T1000!}");
delay(1300);
MySerial.println("{#015P0620T1000!}");
delay(1300);
MySerial.println("{#015P1500T1000!}");
delay(1300);
MySerial.println("{#015P1000T1000!}");
delay(1300);
MySerial.println("{#015P1000T600!}");
delay(1300);
MySerial.println("{#015P1500T1000!}");
delay(1300);
MySerial.println("{#015P0620T1000!}");
delay(1300);
MySerial.println("{#015P0620T500!}");
delay(1300);
MySerial.println("{#015P1500T1000!}");
delay(1300);
MySerial.println("{!#016P1500T1000!}");  // ################
delay(1300);

// 第三部分指令组
MySerial.println("{#015P0600T1000!#016P1754T1000!}");
delay(1300);
MySerial.println("{#015P620T1000!}");
delay(1300);
MySerial.println("{#015P620T1000!}");
delay(1300);
MySerial.println("{#015P1800T1000!}");
delay(1300);
MySerial.println("{#015P0620T1000!}");
delay(1300);
MySerial.println("{#015P1500T1000!}");
delay(1300);
MySerial.println("{#015P1500T1000!}");
delay(1300);
MySerial.println("{#015P0620T1000!}");
delay(1500);
MySerial.println("{#016P1500T1000!}");

// 最后特殊指令
MySerial.println("{#015P1800T3000!#016P1500T1000!}");
delay(1300);
}


void setup() {
//   // 初始化引脚
  ESP32PWM::allocateTimer(0);
  ESP32PWM::allocateTimer(1);
  ESP32PWM::allocateTimer(2);
  ESP32PWM::allocateTimer(3);
  servo.setPeriodHertz(50);  // standard 50 hz servo
  servo.attach(servoPin, 500, 2500);
  servo.write(90);
  MySerial.begin(115200); // 确保波特率与 Python 程序一致
  pinMode(13, INPUT);
  pinMode(12, INPUT);
  pinMode(7, INPUT);
  pinMode(8, INPUT);
  pinMode(9, INPUT);
}

void loop() {

  if(digitalRead(13)){
    if(first)
      {
      //运动预备状态，前进第一步
      //左前右后抬，左后右前原地
      MySerial.println("{G0002#001P1500T0500!#002P1500T0500!#003P1500T0500!#004P1100T0500!#005P1400T0500!#006P1000T0500!#007P1500T0500!#008P1500T0500!#009P1500T0500!#010P1800T0500!#011P1700T0500!#012P1700T0500!}");
      delay(510);
      first=0;}

      //左前右后点地，左后右前抬
      MySerial.println("{G0003#001P1700T0500!#002P1500T0500!#003P2000T0500!#004P1200T0500!#005P1100T0500!#006P1300T0500!#007P1400T0500!#008P1750T0500!#009P1600T0500!#010P1700T0500!#011P1500T0500!#012P1700T0500!}");
      delay(510);
      
      //左前右后拉
      MySerial.println("{G0004#001P1700T0500!#002P1500T0500!#003P2000T0500!#004P1200T0500!#005P1300T0500!#006P1500T0500!#007P1400T0500!#008P1750T0500!#009P1600T0500!#010P1500T0500!#011P1400T0500!#012P1400T0500!}");
      delay(510);
      
      //左前右后抬，左后右前点地
      MySerial.println("{G0005#001P1600T0500!#002P1900T0500!#003P2000T0500!#004P1100T0500!#005P1400T0500!#006P1000T0500!#007P1400T0500!#008P1750T0500!#009P1800T0500!#010P1800T0500!#011P1700T0500!#012P1700T0500!}");
      delay(510);
      
      //左后右前拉
      MySerial.println("{G0006#001P1500T0500!#002P1600T0500!#003P1400T0500!#004P1100T0500!#005P1400T0500!#006P1000T0500!#007P1600T0500!#008P1200T0500!#009P1500T0500!#010P1800T0500!#011P1700T0500!#012P1700T0500!}");
      delay(510);
  }


  else if(digitalRead(12)){
    open_servo();

    
  }
  else if(digitalRead(8)){
    music();

  }
  else if(digitalRead(7)){
    MySerial.println("#016P1756T1000!");
    delay(200);
    MySerial.println("#016P1500T1000!");
  }
  else if(digitalRead(9)){
    standing_up();
  }
  else{
    //  初始状态
    MySerial.println("{G0001#001P1500T0500!#002P1500T0500!#003P1500T0500!#004P1500T0500!#005P1500T0500!#006P1500T0500!#007P1500T0500!#008P1500T0500!#009P1500T0500!#010P1500T0500!#011P1500T0500!#012P1500T0500!}");
    delay(510);
    first=1;  }
}